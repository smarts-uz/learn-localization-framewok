{"version":3,"file":"index.js","sources":["../../../../src/render/PlasmicImg/index.tsx"],"sourcesContent":["/**\n * Responsive `<img/>` replacement, based on `next/image`\n */\n\nimport classNames from \"classnames\";\nimport React, { CSSProperties } from \"react\";\nimport { pick } from \"../../common\";\nimport { mergeRefs } from \"../../react-utils\";\n\nexport interface ImageLoader {\n  supportsUrl: (url: string) => boolean;\n  transformUrl: (opts: {\n    src: string;\n    width?: number;\n    quality?: number;\n    format?: \"webp\";\n  }) => string;\n}\n\ntype ImgTagProps = Omit<\n  React.ComponentProps<\"img\">,\n  \"src\" | \"srcSet\" | \"ref\" | \"style\"\n>;\n\nconst IMG_OPTIMIZER_HOST = \"https://img.plasmic.app\";\n\n// Default image sizes to snap to\n// TODO: make this configurable?\nconst IMG_SIZES = [16, 32, 48, 64, 96, 128, 256, 384];\nconst DEVICE_SIZES = [640, 750, 828, 1080, 1200, 1920, 2048, 3840];\nconst ALL_SIZES = [...IMG_SIZES, ...DEVICE_SIZES];\n\nexport interface PlasmicImgProps extends ImgTagProps {\n  /**\n   * Either an object with the src string, and its full width and height,\n   * or just a src string with unknown intrinsic dimensions.\n   */\n  src?:\n    | string\n    | {\n        src:\n          | string\n          | {\n              src: string;\n              height: number;\n              width: number;\n              blurDataURL?: string;\n            };\n        fullHeight: number;\n        fullWidth: number;\n        // We might also get a more precise aspectRatio for SVGs\n        // instead of relyiing on fullWidth / fullHeight, because\n        // those values might be rounded and not so accurate.\n        aspectRatio?: number;\n      };\n\n  /**\n   * className applied to the wrapper element if one is used.\n   */\n  className?: string;\n\n  /**\n   * css width\n   */\n  displayWidth?: number | string;\n\n  /**\n   * css height\n   */\n  displayHeight?: number | string;\n\n  /**\n   * css min-width\n   */\n  displayMinWidth?: number | string;\n\n  /**\n   * css min-height\n   */\n  displayMinHeight?: number | string;\n\n  /**\n   * css max-width\n   */\n  displayMaxWidth?: number | string;\n\n  /**\n   * css max-height\n   */\n  displayMaxHeight?: number | string;\n\n  /**\n   * For variable quality formats like jpg, the quality from 0 to 100\n   */\n  quality?: number;\n\n  /**\n   * ImageLoader to use for loading different dimensions of the image.\n   * If none specified, will not attempt to load different dimensions.\n   */\n  loader?: \"plasmic\" | ImageLoader;\n\n  /**\n   * Style applied to the wrapper element. objectFit and objectPosition\n   * rules are applied to the img element.\n   */\n  style?: React.CSSProperties;\n\n  /**\n   * Ref for the img element.  The normal <PlasmicImg ref={...} />\n   * prop gives the root element instead, which may be the img element\n   * or a wrapper element\n   */\n  imgRef?: React.Ref<HTMLImageElement>;\n}\n\nexport const PlasmicImg = React.forwardRef(function PlasmicImg(\n  props: PlasmicImgProps,\n  outerRef: React.Ref<HTMLElement>\n) {\n  let {\n    src,\n    className,\n    displayWidth,\n    displayHeight,\n    displayMinWidth,\n    displayMinHeight,\n    displayMaxWidth,\n    displayMaxHeight,\n    quality,\n    loader,\n    imgRef,\n    style,\n    loading,\n    ...rest\n  } = props;\n\n  const imgProps = Object.assign({}, rest, {\n    // Default loading to \"lazy\" if not specified (which is different from the\n    // html img, which defaults to eager!)\n    loading: loading ?? \"lazy\",\n  });\n\n  const { fullWidth, fullHeight, aspectRatio } = !src\n    ? { fullWidth: undefined, fullHeight: undefined, aspectRatio: undefined }\n    : typeof src === \"string\"\n    ? getImageSizeData(\n        getPixelLength(props.width),\n        getPixelLength(props.height)\n      )\n    : src;\n  const srcStr = src\n    ? typeof src === \"string\"\n      ? src\n      : typeof src.src === \"string\"\n      ? src.src\n      : src.src.src\n    : \"\";\n\n  // Assume external image if either dimension is null and use usual <img>\n  if (fullHeight == null || fullWidth == null) {\n    return (\n      <img\n        src={srcStr}\n        className={className}\n        style={style}\n        {...imgProps}\n        loading={loading}\n        ref={mergeRefs(imgRef, outerRef) as any}\n      />\n    );\n  }\n\n  if (\n    isSvg(srcStr) &&\n    (displayHeight == null || displayHeight === \"auto\") &&\n    (displayWidth == null || displayWidth === \"auto\")\n  ) {\n    displayWidth = \"100%\";\n  }\n\n  let computedDisplayWidth = displayWidth;\n  if (\n    fullWidth &&\n    fullHeight &&\n    (!displayWidth || displayWidth === \"auto\") &&\n    !!getPixelLength(displayHeight)\n  ) {\n    // If there's a pixel length specified for displayHeight but not displayWidth,\n    // then we can derive the pixel length for displayWidth.  Having an explicit\n    // displayWidth makes this a fixed-size image, which makes it possible for us to\n    // generate better markup!\n    if (!isSvg(srcStr)) {\n      // We shouldn't do it for SVGs though, because `fullWidth` and\n      // `fullHeight` might have rounded values so the final\n      // `displayWidth` could differ by 1px or so.\n      computedDisplayWidth =\n        (getPixelLength(displayHeight)! * fullWidth) / fullHeight;\n    }\n  }\n\n  let spacerWidth = fullWidth;\n  let spacerHeight = fullHeight;\n  if (aspectRatio && isFinite(aspectRatio) && isSvg(srcStr)) {\n    // For SVGs, fullWidth and fullHeight can be rounded values, which would\n    // cause some discrepancy between the actual aspect ratio and the aspect\n    // ratio from those values. So, for those cases, we set large width / height\n    // values to get a more precise ratio from the spacer.\n    spacerWidth = DEFAULT_SVG_WIDTH;\n    spacerHeight = Math.round(spacerWidth / aspectRatio);\n  }\n\n  const { sizes, widthDescs } = getWidths(computedDisplayWidth, fullWidth, {\n    minWidth: displayMinWidth,\n  });\n  const imageLoader = getImageLoader(loader);\n  const spacerSvg = `<svg width=\"${spacerWidth}\" height=\"${spacerHeight}\" xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\"/>`;\n  const spacerSvgBase64 =\n    // if btoa exists, use btoa, as it works in browser and in\n    // cloudflare edge workers.  For node, use Buffer.from().\n    typeof globalThis.btoa === \"function\"\n      ? globalThis.btoa(spacerSvg)\n      : Buffer.from(spacerSvg).toString(\"base64\");\n\n  let wrapperStyle: CSSProperties = { ...(style || {}) };\n  let spacerStyle: CSSProperties = {\n    ...pick(style || {}, \"objectFit\", \"objectPosition\"),\n  };\n\n  if (displayWidth != null && displayWidth !== \"auto\") {\n    // If width is set, set it on the wrapper along with min/max width\n    // and just use `width: 100%` on the spacer\n    spacerStyle.width = \"100%\";\n    // Rely on the styles set by `classname` on the wrapper:\n    // wrapperStyle.width = displayWidth;\n    // wrapperStyle.minWidth = displayMinWidth;\n    // wrapperStyle.maxWidth = displayMaxWidth;\n  } else {\n    // Otherwise, we want auto sizing from the spacer, so set width there.\n    //\n    // But if we have min/max width, it should be set in the wrapper and it\n    // can be percentage values (and we add corresponding min/max width to\n    // 100% in the spacer). In general it ends up with the correct effect,\n    // but some edge cases might make `min-width: 100%` shrink the image more\n    // than it should.\n    spacerStyle.width = displayWidth;\n    wrapperStyle.width = \"auto\";\n    if (displayMinWidth) {\n      spacerStyle.minWidth = \"100%\";\n      // Rely on min-width set by `classname` on the wrapper:\n      // wrapperStyle.minWidth = displayMinWidth;\n    }\n    if (displayMaxWidth != null && displayMaxWidth !== \"none\") {\n      spacerStyle.maxWidth = \"100%\";\n      // Rely on max-width set by `classname` on the wrapper:\n      // wrapperStyle.maxWidth = displayMaxWidth;\n    }\n  }\n\n  if (displayHeight != null && displayHeight !== \"auto\") {\n    spacerStyle.height = \"100%\";\n    // wrapperStyle.height = displayHeight;\n    // wrapperStyle.minHeight = displayMinHeight;\n    // wrapperStyle.maxHeight = displayMaxHeight;\n  } else {\n    spacerStyle.height = displayHeight;\n    wrapperStyle.height = \"auto\";\n    if (displayMinHeight) {\n      spacerStyle.minHeight = \"100%\";\n      // wrapperStyle.minHeight = displayMinHeight;\n    }\n    if (displayMaxHeight != null && displayMaxHeight !== \"none\") {\n      spacerStyle.maxHeight = \"100%\";\n      // wrapperStyle.maxHeight = displayMaxHeight;\n    }\n  }\n\n  return (\n    <div\n      className={classNames(className, \"__wab_img-wrapper\")}\n      ref={outerRef as any}\n      style={wrapperStyle}\n    >\n      <img\n        alt=\"\"\n        aria-hidden\n        className=\"__wab_img-spacer-svg\"\n        src={`data:image/svg+xml;base64,${spacerSvgBase64}`}\n        style={spacerStyle}\n      />\n      {makePicture({\n        imageLoader,\n        widthDescs,\n        sizes,\n        src: srcStr,\n        quality,\n        ref: imgRef,\n        style: style ? pick(style, \"objectFit\", \"objectPosition\") : undefined,\n        imgProps,\n        className: \"__wab_img\",\n      })}\n    </div>\n  );\n});\n\nfunction makePicture(opts: {\n  imageLoader?: ImageLoader;\n  widthDescs: WidthDesc[];\n  sizes?: string;\n  src: string;\n  quality?: number;\n  style?: React.CSSProperties;\n  className?: string;\n  imgProps: ImgTagProps;\n  ref?: React.Ref<HTMLImageElement>;\n}) {\n  // If imageLoader is undefined, then this renders to just a normal\n  // <img />.  Else it will render to a <picture> with a <source> for\n  // webp, and srcSet/sizes set according to width requirements.\n  const {\n    imageLoader,\n    widthDescs,\n    src,\n    quality,\n    style,\n    className,\n    sizes,\n    imgProps,\n    ref,\n  } = opts;\n  return (\n    <picture className=\"__wab_picture\">\n      {imageLoader && imageLoader.supportsUrl(src) && (\n        <source\n          type=\"image/webp\"\n          srcSet={widthDescs\n            .map(\n              (wd) =>\n                `${imageLoader.transformUrl({\n                  src,\n                  quality,\n                  width: wd.width,\n                  format: \"webp\",\n                })} ${wd.desc}`\n            )\n            .join(\", \")}\n        />\n      )}\n      <img\n        {...imgProps}\n        ref={ref}\n        className={className}\n        decoding=\"async\"\n        src={\n          imageLoader && imageLoader.supportsUrl(src)\n            ? imageLoader.transformUrl({\n                src,\n                quality,\n                width: widthDescs[widthDescs.length - 1].width,\n              })\n            : src\n        }\n        srcSet={\n          imageLoader && imageLoader.supportsUrl(src)\n            ? widthDescs\n                .map(\n                  (wd) =>\n                    `${imageLoader.transformUrl({\n                      src,\n                      quality,\n                      width: wd.width,\n                    })} ${wd.desc}`\n                )\n                .join(\", \")\n            : undefined\n        }\n        sizes={imageLoader && imageLoader.supportsUrl(src) ? sizes : undefined}\n        style={{\n          ...(style ? pick(style, \"objectFit\", \"objectPosition\") : {}),\n          width: 0,\n          height: 0,\n        }}\n      />\n    </picture>\n  );\n}\n\nconst DEFAULT_SVG_WIDTH = 10000;\n\nfunction isSvg(src: string) {\n  return src.endsWith(\".svg\") || src.startsWith(\"data:image/svg\");\n}\n\ninterface WidthDesc {\n  width?: number;\n  desc: string;\n}\n\nfunction getClosestPresetSize(width: number, fullWidth: number) {\n  const nextBiggerIndex =\n    ALL_SIZES.findIndex((w) => w >= width) ?? ALL_SIZES.length - 1;\n  const nextBigger = ALL_SIZES[nextBiggerIndex];\n  if (nextBigger >= fullWidth) {\n    // If the requested width is larger than the fullWidth,\n    // we just use the original width instead. It's impossible\n    // to make an image bigger than fullWidth!\n    return undefined;\n  } else if (\n    nextBiggerIndex + 1 < ALL_SIZES.length &&\n    fullWidth <= ALL_SIZES[nextBiggerIndex + 1]\n  ) {\n    // If the fullWidth is just between nextBigger and the one after that,\n    // then also might as well just use the original size (so, width is 30,\n    // nextBigger is 32, then we just use the original as long as fullWidth is\n    // less than 48)\n    return undefined;\n  }\n\n  return nextBigger;\n}\n\n/**\n * Computes the appropriate srcSet and sizes to use\n */\nfunction getWidths(\n  width: number | string | undefined,\n  fullWidth: number,\n  extra?: { minWidth: string | number | undefined }\n): { sizes: string | undefined; widthDescs: WidthDesc[] } {\n  const minWidth = extra?.minWidth;\n  const pixelWidth = getPixelLength(width);\n  const pixelMinWidth = getPixelLength(minWidth);\n  if (pixelWidth != null && (!minWidth || pixelMinWidth != null)) {\n    // If there's an exact width, then we just need to display it at 1x and 2x density\n    return {\n      widthDescs: [\n        {\n          width: getClosestPresetSize(\n            Math.max(pixelWidth, pixelMinWidth ?? 0),\n            fullWidth\n          ),\n          desc: \"1x\",\n        },\n        {\n          width: getClosestPresetSize(\n            Math.max(pixelWidth, pixelMinWidth ?? 0) * 2,\n            fullWidth\n          ),\n          desc: \"2x\",\n        },\n      ],\n      sizes: undefined,\n    };\n  }\n  // Otherwise we don't know what sizes we'll end up, so we just cap it at\n  // device width.  TODO: do better!\n  const usefulSizes = DEVICE_SIZES.filter(\n    (size) => !fullWidth || size < fullWidth\n  );\n  if (!!fullWidth && usefulSizes.length === 0) {\n    // image fullWidth is smaller than all device sizes.  So all we can do\n    // is offer 1x\n    return {\n      widthDescs: [\n        {\n          width: getClosestPresetSize(fullWidth, fullWidth),\n          desc: \"1x\",\n        },\n      ],\n      sizes: undefined,\n    };\n  }\n  return {\n    widthDescs: usefulSizes.map((size) => ({\n      width: getClosestPresetSize(size, fullWidth),\n      // If this is the last (buggest) useful width, but it is\n      // still within the bounds set by DEVICE_SIZES, then just\n      // use the original, unresized image.  This means if we match\n      // the largest size, we use unresized and best quality image.\n      // We only do this, though, if fullWidth is \"reasonable\" --\n      // smaller than the largest size we would consider.\n      // i === usefulSizes.length - 1 &&\n      // fullWidth < DEVICE_SIZES[DEVICE_SIZES.length - 1]\n      //   ? undefined\n      //   : size,\n      desc: `${size}w`,\n    })),\n    sizes: \"100vw\",\n  };\n}\n\nfunction getPixelLength(length: number | string | undefined) {\n  if (length == null || length == \"\") {\n    return undefined;\n  }\n\n  if (typeof length === \"number\") {\n    return length;\n  }\n\n  const parsed = parseNumeric(length);\n  if (parsed && (!parsed.units || parsed.units === \"px\")) {\n    return parsed.num;\n  }\n\n  return undefined;\n}\n\nfunction parseNumeric(val: string) {\n  // Parse strings like \"30\", \"30px\", \"30%\", \"30px /* blah blah */\"\n  const res = val.match(\n    /^\\s*(-?(?:\\d+\\.\\d*|\\d*\\.\\d+|\\d+))\\s*([a-z]*|%)\\s*(?:\\/\\*.*)?$/i\n  );\n  if (res == null) {\n    return undefined;\n  }\n  const num = res[1];\n  const units = res[2];\n  return { num: +num, units };\n}\n\nfunction getImageSizeData(\n  width: number | undefined,\n  height: number | undefined\n) {\n  const aspectRatio = width && height ? width / height : undefined;\n  return {\n    fullWidth: width,\n    fullHeight: height,\n    aspectRatio: aspectRatio && isFinite(aspectRatio) ? aspectRatio : undefined,\n  };\n}\n\nfunction getImageLoader(loader: \"plasmic\" | ImageLoader | undefined) {\n  if (loader == null) {\n    return undefined;\n  } else if (loader === \"plasmic\") {\n    return PLASMIC_IMAGE_LOADER;\n  } else {\n    return loader;\n  }\n}\n\nfunction isInternalKey(src: string) {\n  return /^([a-f0-9]{32})\\..{1,16}$/i.test(src);\n}\n\nconst PLASMIC_IMAGE_LOADER: ImageLoader = {\n  supportsUrl: (src) => {\n    return (src.startsWith(\"http\") || isInternalKey(src)) && !isSvg(src);\n  },\n  transformUrl: (opts) => {\n    const params = [\n      `src=${encodeURIComponent(opts.src)}`,\n      opts.width ? `w=${opts.width}` : undefined,\n      `q=${opts.quality ?? 75}`,\n      opts.format ? `f=${opts.format}` : undefined,\n    ].filter((x) => !!x);\n    return `${IMG_OPTIMIZER_HOST}/img-optimizer/v1/img?${params.join(\"&\")}`;\n  },\n};\n"],"names":["React"],"mappings":"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"}